<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {{block "head" .}}
    <title>{{ .Site.Title }}</title>
    {{end}}

    <link rel="stylesheet" href="/assets/main.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <div class="logowrap">
                <a class="logo" href="/">{{ .Site.Title }}</a>
            </div>
            <nav class="site-navbar">
                <ul>
                    <li>
                        <a href="/">首页</a>
                    </li>
                    <li>
                        <a href="/search">查询</a>
                    </li>
                    <li>
                        <a href="/tag">标签</a>
                    </li>
                    <!-- <li>
                        <a href="/archive">归档</a>
                    </li> -->
                    {{- if not .Auth.IsLogin -}}
                    <li>
                        <a href="/auth">登录</a>
                    </li>
                    {{- else -}}
                    <li>
                        <a href="/gitpull">git pull</a>
                    </li>
                    {{- end -}}
                </ul>
            </nav>
        </header>

        <main class="content">
            {{block "content" .}}
            {{end}}
        </main>

        <footer>
            <p>
                Powered by <a href="https://github.com/MACDfree/obsidian-web" target="_blank">obsidian-web</a> | <a href="https://github.com/MACDfree" target="_blank">GitHub</a> | <a href="mailto:macdfree@163.com">Email</a>
            </p>
        </footer>
    </div>

    <!-- 图片查看器 -->
    <div id="image-viewer" class="image-viewer">
        <div class="image-viewer-content">
            <span class="image-viewer-close">&times;</span>
            <img id="viewer-image" class="viewer-image" src="" alt="放大图片">
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取图片查看器元素
            const imageViewer = document.getElementById('image-viewer');
            const viewerImage = document.getElementById('viewer-image');
            const closeBtn = document.querySelector('.image-viewer-close');
            
            // 为所有图片添加点击事件
            function addImageClickListeners() {
                const images = document.querySelectorAll('img');
                images.forEach(img => {
                    // 避免重复添加事件
                    if (!img.hasAttribute('data-image-viewer')) {
                        img.setAttribute('data-image-viewer', 'true');
                        img.addEventListener('click', function(e) {
                            // 阻止事件冒泡，避免触发其他点击事件
                            e.stopPropagation();
                            
                            // 设置查看器图片源
                            viewerImage.src = this.src;
                            
                            // 显示查看器
                            imageViewer.style.display = 'flex';
                            
                            // 添加缩放初始化
                            viewerImage.style.transform = 'scale(1)';
                            viewerImage.style.transition = 'transform 0.3s ease';
                            
                            // 禁止页面滚动
                            document.body.style.overflow = 'hidden';
                        });
                    }
                });
            }
            
            // 初始添加事件监听器
            addImageClickListeners();
            
            // 监听DOM变化，为动态加载的图片添加事件
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.addedNodes.length > 0) {
                        addImageClickListeners();
                    }
                });
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
            
            // 关闭查看器
            function closeViewer() {
                imageViewer.style.display = 'none';
                document.body.style.overflow = '';
            }
            
            // 点击关闭按钮
            closeBtn.addEventListener('click', closeViewer);
            
            // 点击查看器背景关闭
            imageViewer.addEventListener('click', function(e) {
                if (e.target === imageViewer) {
                    closeViewer();
                }
            });
            
            // 按ESC键关闭
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && imageViewer.style.display === 'flex') {
                    closeViewer();
                }
            });
            
            // 实现图片缩放
            let scale = 1;
            const scaleStep = 0.1;
            const minScale = 0.1;
            const maxScale = 5;
            
            viewerImage.addEventListener('wheel', function(e) {
                e.preventDefault();
                
                // 计算缩放方向
                const delta = e.deltaY > 0 ? -scaleStep : scaleStep;
                scale = Math.max(minScale, Math.min(maxScale, scale + delta));
                
                // 应用缩放
                viewerImage.style.transform = `scale(${scale})`;
            });
            
            // 支持触摸设备的缩放
            let touchStartDistance = 0;
            let touchStartScale = 1;
            
            viewerImage.addEventListener('touchstart', function(e) {
                if (e.touches.length === 2) {
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];
                    touchStartDistance = Math.hypot(
                        touch2.clientX - touch1.clientX,
                        touch2.clientY - touch1.clientY
                    );
                    touchStartScale = scale;
                }
            });
            
            viewerImage.addEventListener('touchmove', function(e) {
                if (e.touches.length === 2) {
                    e.preventDefault();
                    
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];
                    const touchDistance = Math.hypot(
                        touch2.clientX - touch1.clientX,
                        touch2.clientY - touch1.clientY
                    );
                    
                    const newScale = touchStartScale * (touchDistance / touchStartDistance);
                    scale = Math.max(minScale, Math.min(maxScale, newScale));
                    
                    viewerImage.style.transform = `scale(${scale})`;
                }
            });
        });
    </script>

</body>

</html>